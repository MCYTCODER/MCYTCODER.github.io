<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VyXo Chat</title>
<style>
body { font-family: Arial,sans-serif; background:#181818; color:#F1F1F1; margin:0; display:flex; flex-direction:column; height:100vh; }
header { padding:15px; background:#00C4FF; text-align:center; font-weight:bold; font-size:20px; }
#chat { flex:1; overflow-y:auto; padding:10px; }
.message { margin-bottom:10px; }
.message .user { font-weight:bold; color:#FF6D1F; }
input, button { padding:10px; margin:5px; border-radius:8px; border:none; }
input[type="text"] { flex:1; }
#inputContainer { display:flex; padding:10px; background:#202020; }
</style>
</head>
<body>

<header>VyXo Chat</header>
<div id="chat"></div>
<div id="inputContainer">
  <input type="text" id="messageInput" placeholder="Type a message...">
  <button id="sendBtn">Send</button>
  <button id="imgBtn">ðŸ“·</button>
  <button id="voiceBtn">ðŸŽ¤</button>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.3.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.3.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.3.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.3.1/firebase-storage-compat.js"></script>

<script>
// --- Firebase config ---
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_PROJECT.appspot.com",
  messagingSenderId: "SENDER_ID",
  appId: "APP_ID"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();
const storage = firebase.storage();

// --- Anonymous login ---
auth.signInAnonymously().catch(console.error);
let username = prompt("Enter your username:");

// --- Send message ---
const chatDiv = document.getElementById("chat");
const msgInput = document.getElementById("messageInput");
document.getElementById("sendBtn").addEventListener("click",sendMessage);
function sendMessage(){
  const text = msgInput.value;
  if(!text) return;
  db.collection("messages").add({
    user: username,
    text: text,
    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
    type: "text"
  });
  msgInput.value="";
}

// --- Send image ---
document.getElementById("imgBtn").addEventListener("click", async ()=>{
  const file = document.createElement("input");
  file.type="file"; file.accept="image/*";
  file.click();
  file.onchange=async ()=>{
    const f = file.files[0];
    const ref = storage.ref().child('images/'+Date.now()+'_'+f.name);
    await ref.put(f);
    const url = await ref.getDownloadURL();
    db.collection("messages").add({
      user: username,
      image:url,
      timestamp: firebase.firestore.FieldValue.serverTimestamp(),
      type: "image"
    });
  }
});

// --- Send voice message ---
let mediaRecorder, audioChunks=[];
document.getElementById("voiceBtn").addEventListener("mousedown", async ()=>{
  const stream = await navigator.mediaDevices.getUserMedia({audio:true});
  mediaRecorder = new MediaRecorder(stream);
  audioChunks=[];
  mediaRecorder.ondataavailable=e=>audioChunks.push(e.data);
  mediaRecorder.start();
});
document.getElementById("voiceBtn").addEventListener("mouseup", async ()=>{
  mediaRecorder.stop();
  mediaRecorder.onstop = async ()=>{
    const blob = new Blob(audioChunks,{type:'audio/webm'});
    const ref = storage.ref().child('voice/'+Date.now()+'.webm');
    await ref.put(blob);
    const url = await ref.getDownloadURL();
    db.collection("messages").add({
      user: username,
      voice:url,
      timestamp: firebase.firestore.FieldValue.serverTimestamp(),
      type: "voice"
    });
  };
});

// --- Display messages ---
db.collection("messages").orderBy("timestamp").onSnapshot(snapshot=>{
  chatDiv.innerHTML="";
  snapshot.forEach(doc=>{
    const msg = doc.data();
    const div = document.createElement("div");
    div.className="message";
    div.innerHTML=`<span class="user">${msg.user}:</span> `;
    if(msg.type==="text") div.innerHTML+=msg.text;
    if(msg.type==="image") div.innerHTML+=`<img src="${msg.image}" width="200">`;
    if(msg.type==="voice") div.innerHTML+=`<audio controls src="${msg.voice}"></audio>`;
    chatDiv.appendChild(div);
    chatDiv.scrollTop = chatDiv.scrollHeight;
  });
});
</script>

</body>
</html>
