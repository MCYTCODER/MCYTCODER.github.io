<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>3D Horror Game Prototype</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #000;
            font-family: Arial, sans-serif;
            touch-action: manipulation; /* Screen lock */
        }
        canvas {
            display: block;
        }
        /* Overlay for UI elements like a simple message */
        #overlay {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: red;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px 20px;
            border-radius: 5px;
            font-size: 1.2em;
            z-index: 10;
        }
    </style>
</head>
<body>
    <div id="overlay">Welcome to the dark room...</div>

    <script src="https://cdn.jsdelivr.net/npm/three@0.137.0/build/three.min.js"></script>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

    <script>
        // --- 1. YOUR FIREBASE CONFIGURATION ---
        const firebaseConfig = {
          apiKey: "AIzaSyAMRPAoSdZgTBOKZkVpFoD8u8peIw8GcAg",
          authDomain: "tic-tac-toe-998c6.firebaseapp.com",
          databaseURL: "https://tic-tac-toe-998c6-default-rtdb.europe-west1.firebasedatabase.app",
          projectId: "tic-tac-toe-998c6",
          storageBucket: "tic-tac-toe-998c6.firebasestorage.app",
          messagingSenderId: "874071203416",
          appId: "1:874071203416:web:2b4eacc393270f2c8df42d"
        };
        
        const app = firebase.initializeApp(firebaseConfig);
        const database = app.database();
        
        // Simple reference for future horror game tracking (e.g., survival data)
        const GAME_REF = database.ref('horror_game_data');

        // --- 2. THREE.JS 3D SETUP ---
        let scene, camera, renderer;
        
        function init3D() {
            // Setup Scene
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x000000); // Black background for horror

            // Setup Camera (Perspective)
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 1.6, 5); // Default player height (1.6m) and position

            // Setup Renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);
            
            // --- CREATE THE HORROR ROOM ---

            // Floor
            const floorGeometry = new THREE.PlaneGeometry(10, 10);
            // Use a dark, muddy color for the floor
            const floorMaterial = new THREE.MeshStandardMaterial({ color: 0x333333, roughness: 0.8, metalness: 0.1 }); 
            const floor = new THREE.Mesh(floorGeometry, floorMaterial);
            floor.rotation.x = -Math.PI / 2; // Rotate to lie flat
            floor.receiveShadow = true;
            scene.add(floor);

            // Walls (Basic cubes for simplicity)
            const wallMaterial = new THREE.MeshStandardMaterial({ color: 0x444444, roughness: 0.9 });
            const wallDepth = 0.1;

            // Back Wall
            const backWall = new THREE.Mesh(new THREE.BoxGeometry(10, 5, wallDepth), wallMaterial);
            backWall.position.set(0, 2.5, -5);
            scene.add(backWall);

            // Left Wall
            const leftWall = new THREE.Mesh(new THREE.BoxGeometry(wallDepth, 5, 10), wallMaterial);
            leftWall.position.set(-5, 2.5, 0);
            scene.add(leftWall);
            
            // Right Wall
            const rightWall = new THREE.Mesh(new THREE.BoxGeometry(wallDepth, 5, 10), wallMaterial);
            rightWall.position.set(5, 2.5, 0);
            scene.add(rightWall);

            // --- LIGHTING (Horror atmosphere requires low light) ---

            // Ambient Light (Very low background light)
            const ambientLight = new THREE.AmbientLight(0x404040, 0.1); 
            scene.add(ambientLight);

            // Point Light (Simulating a single, weak bulb or flashlight)
            const pointLight = new THREE.PointLight(0xffaa00, 1.5, 10); // Weak yellow/orange light
            pointLight.position.set(0, 3, 0);
            scene.add(pointLight);

            // --- FOG (For atmospheric horror effect) ---
            scene.fog = new THREE.Fog(0x000000, 1, 15); // Black fog that starts close

            // --- EXAMPLE OBJECT (Something creepy) ---
            const boxGeometry = new THREE.BoxGeometry(0.5, 0.5, 0.5);
            const boxMaterial = new THREE.MeshStandardMaterial({ color: 0x880000 }); // Dark Red/Blood color
            const creepyBox = new THREE.Mesh(boxGeometry, boxMaterial);
            creepyBox.position.set(2, 0.25, -3); // Place it on the floor
            scene.add(creepyBox);
        }

        // --- 3. GAME LOOP ---
        function animate() {
            requestAnimationFrame(animate);
            
            // This is where all future game logic will go (e.g., enemy movement, door opening)
            
            renderer.render(scene, camera);
        }

        // Handle window resizing
        window.addEventListener('resize', onWindowResize, false);
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        // --- 4. FIREBASE LOGIC (Placeholder) ---
        function sendHeartbeat() {
             // Example function: update a last-seen timestamp to track survival time
             const userId = localStorage.getItem('horror_user_id') || `user_${Math.random().toString(36).substring(2, 5)}`;
             localStorage.setItem('horror_user_id', userId);

             GAME_REF.child('active_players').child(userId).set({
                 lastSeen: firebase.database.ServerValue.TIMESTAMP
             });
             
             // Remove when user disconnects
             GAME_REF.child('active_players').child(userId).onDisconnect().remove();
        }

        // --- 5. INITIALIZATION ---
        init3D();
        animate();
        sendHeartbeat(); // Start tracking player presence
        
        // Optional: Send heartbeat every 10 seconds to keep track of active user
        setInterval(sendHeartbeat, 10000); 

    </script>
</body>
</html>
